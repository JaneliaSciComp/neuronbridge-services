service: janelia-neuronbridge-align

projectDir: ../

plugins:
  - serverless-deployment-bucket
  - serverless-vpc-plugin


custom:
  stackName: ${self:service}-${self:provider.stage}
  alignmentTemplatesBucket: ${file(../config.yml):config.alignmentTemplatesBucket}
  alignmentTemplatesFolder: alignment_templates
  alignInputBucket: ${file(../config.yml):config.searchBucket}
  alignOutputBucket: ${file(../config.yml):config.searchBucket}
  version: ${file(../config.yml):config.version}
  debug: ${file(../config.yml):config.debug}
  securityGroupId: sg-963ee8df
  subnetId: subnet-5e11c814
  ec2AlignmentImageId: ami-0d3f5e4624981ef1b
  alignmentContainerImage: janeliascicomp/neuronbridge-aligner:1.1
  defaultAlignmentThreads: 16

  vpcConfig:
    enabled: true
    cidrBlock: '10.0.0.0/16'
    createNatGateway: 1
    createNetworkAcl: false
    createDbSubnet: false
    createFlowLogs: false
    createNatInstance: false
    createParameters: true
    zones:
      - us-east-1a
      - us-east-1b
      - us-east-1c
    exportOutputs: true


provider:
  name: aws
  region: ${opt:region, "us-east-1"}
  stage: ${file(../config.yml):config.stage}
  deploymentBucket:
    name: janelia-serverless-deployments
    blockPublicAccess: true
  tags:
    PROJECT: ${file(../config.yml):config.project}
    VERSION: ${self:custom.version}
    DEVELOPER: ${env:USER}
  stackTags:
    PROJECT: ${file(../config.yml):config.project}
    VERSION: ${self:custom.version}
    DEVELOPER: ${env:USER}
    STAGE: ${self:provider.stage}


package:
  patterns:
    - '!node_modules/**'


resources:
  - ${file(sls_resources/batch.yml)}