service: janelia-neuronbridge-align

plugins:
  - serverless-deployment-bucket
  - serverless-vpc-plugin


custom:
  stackName: ${self:service}-${self:provider.stage}
  version: ${file(../config.yml):config.version}
  debug: ${file(../config.yml):config.debug}
  alignmentTemplatesBucket: ${file(../config.yml):config.alignmentTemplatesBucket}
  brainAlignmentTemplatesFolder: alignment_templates
  vncAlignmentTemplatesFolder: vnc_alignment_templates
  mipTemplatesFolder: alignment_templates
  alignInputBucket: ${file(../config.yml):config.searchBucket}
  alignOutputBucket: ${file(../config.yml):config.searchBucket}
  ec2AlignmentImageId: ami-0d3f5e4624981ef1b
  alignmentBrainContainerImage: janeliascicomp/neuronbridge-brainaligner:1.0
  alignmentVNCContainerImage: janeliascicomp/neuronbridge-vncaligner:1.0
  defaultAlignmentThreads: 16

  vpcConfig:
    enabled: true
    cidrBlock: '10.0.0.0/16'
    createNatGateway: 1
    createNetworkAcl: false
    createDbSubnet: false
    createFlowLogs: false
    createNatInstance: false
    createParameters: true
    zones:
      - us-east-1a
    exportOutputs: true

provider:
  name: aws
  region: ${opt:region, "us-east-1"}
  stage: ${file(../config.yml):config.stage}
  deploymentBucket:
    name: janelia-serverless-deployments
    blockPublicAccess: true
  tags:
    PROJECT: ${file(../config.yml):config.project}
    VERSION: ${self:custom.version}
    DEVELOPER: ${env:USER}
  stackTags:
    PROJECT: ${file(../config.yml):config.project}
    VERSION: ${self:custom.version}
    DEVELOPER: ${env:USER}
    STAGE: ${self:provider.stage}


package:
  patterns:
    - '!node_modules/**'


resources:
  - ${file(sls_resources/batch.yml)}
